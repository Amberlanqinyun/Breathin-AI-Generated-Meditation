{% extends "base.html" %}

{% block title %}
    User Dashboard - Meditation App
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Heatmap Section -->
        <div class="col-md-8">
            <h2>Meditation Activity</h2>
            <div id="heatmap"></div>
        </div>

        <!-- Achievements Section -->
        <div class="col-md-4">
            <h2>Achievements</h2>
            <div class="card">
                <div class="card-body">
                    {% for achievement in achievements %}
                    <div class="achievement-item">
                        <h5>{{ achievement.Type }}</h5>
                        <p>{{ achievement.Description }}</p>
                        <small>Achieved on {{ achievement.AchievedAt.strftime('%Y-%m-%d') }}</small>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Meditation History Section -->
    <div class="row mt-5">
        <div class="col-md-12">
            <h2>Meditation History</h2>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Meditation</th>
                        <th>Duration</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in history %}
                    <tr>
                        <td>{{ session.SessionDate.strftime('%Y-%m-%d') }}</td>
                        <td>{{ session.MeditationName }}</td>
                        <td>{{ session.Duration }}</td>
                        <td>{{ session.Comments }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/cal-heatmap/cal-heatmap.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cal-heatmap/cal-heatmap.css">

<script>
// JavaScript for Heatmap
document.addEventListener('DOMContentLoaded', function() {
    var data = {{ activity | tojson }};
    // Generate heatmap using D3.js or a heatmap library
    var heatmap = new CalHeatMap();
    heatmap.init({
        itemSelector: "#heatmap",
        domain: "month",
        subDomain: "day",
        data: data,
        start: new Date(),
        cellSize: 15,
        range: 12,
        legend: [2, 4, 6, 8, 10]
    });
});
</script>
{% endblock %}
